<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>HTML5</title>
    <!--[if IE]>
   <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
    <style>
        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        hgroup,
        menu,
        nav,
        section {
            display: block;
        }

        .stage-correct {
            color: green;
        }
        .stage-wrong {
            color: red;
        }
        .stage-correct .btn {
            background-color: green !important;
        }
        .stage-wrong .btn {
            background-color: red !important;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div id="StagesHeader">
    </div>
    <div id="Stages">

    </div>
    <button type="button" class="btn btn-primary" onclick="reset()">Сброс</button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        var stages = [
            {
                variants: [
                    "Релятивиская",
                    "Реалистская"
                ],
                correct: "Релятивиская"
            },
            {
                variants: [
                    "Избыточный",
                    "Изготовительный"
                ],
                correct: "Изготовительный"
            },
        ]

        const STAGE_TEMPLATE = `
        <div id="sc-{stage}" class="stage-card">
            <h3>{stage-text}</h3>
            <div class="stage-variants">
                {variants}
            </div>
        </div>
    `
        const BUTTON_TEMPLATE = `
        <button id="btn-{variant-stage}" type="button" class="btn" data-stage="{variant-stage}" data-vtext="{variant-text}" onclick="clicka(this)">{variant-text}</button>
    `
        function reset() {
            stages.forEach((stage, sIdx) => {
                localStorage.removeItem(sIdx);
            });
            update();
        }

        function clicka(btn) {
           /*if (localStorage.getItem(btn.dataset['stage']) return;*/

 localStorage.setItem(btn.dataset['stage'], btn.dataset['vtext']);
            update();
        }
        function update() {

            stages.forEach((stage, sIdx) => {
                let loc = localStorage.getItem(sIdx);
                const sc = document.getElementById('sc-' + sIdx)
                if (loc) {
                    if (loc == stage.correct) {
                        sc.classList.toggle('stage-correct', true);
                        sc.classList.toggle('stage-wrong', false);
                    } else {
                        sc.classList.toggle('stage-correct', false);
                        sc.classList.toggle('stage-wrong', true);
                    }
                } else {
                    sc.classList.toggle('stage-correct', false);
                    sc.classList.toggle('stage-wrong', false);
                }
            });
        }

        let html = ""
        stages.forEach((stage, sIdx) => {
//if (sIdx>0 && !localStorage.getItem(sIdx-1)) break;

            let vhtml = ""
            stage.variants.forEach(variant => {
                vhtml += BUTTON_TEMPLATE.replace(/{variant-stage}/gm, sIdx).replace(/{variant-text}/gm, variant)
            });

            html += STAGE_TEMPLATE.replace(/{stage}/gm, sIdx).replace(/{stage-text}/gm, sIdx + 1).replace(/{variants}/gm, vhtml);
        });

        console.log(html);
        document.getElementById("Stages").innerHTML = html;
        
        update();
    </script>
</body>

</html>