<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>HTML5</title>
    <!--[if IE]>
   <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
    <style>
        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        hgroup,
        menu,
        nav,
        section {
            display: block;
        }

        .stage-correct {
            color: green;
        }

        .stage-wrong {
            color: red;
        }

        .stage-wrong .btn-secondary {
            border: 3px solid red;
        }

        .stage-wrong .variant-correct {
            border: 3px solid green;
        }

        .stage-correct .btn-secondary {
            border: 3px solid green;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div id="StagesHeader">
    </div>
    <div id="Stages">

    </div>
    <button type="button" class="btn btn-primary" onclick="reset()">Сброс</button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        function getRandomZeroOne() {
  return Math.floor(Math.random() + 0.5); // The maximum is exclusive and the minimum is inclusive
}



        const lNoNoise = `1.	Рекомендательная система - Наблюдательная система
2.	Программная среда - Программное средство
3.	Нерелевантная информация - Релевантная информация
4.	Достаточная информация - Избыточная информация
5.	Программное средство - Программная среда
6.	Наблюдательная система - Рекомендательная система
7.	Избыточная информация - Достаточная информация
8.	Релевантная информация - Нерелевантная информация
9.	Программная среда - Программное средство
10.	Рекомендательная система - Наблюдательная система
11.	Достаточная информация - Избыточная информация
12.	Нерелевантная информация - Релевантная информация
13.	Наблюдательная система - Рекомендательная система
14.	Избыточная информация - Достаточная информация
15.	Программное средство - Программная среда
16.	Релевантная информация - Нерелевантная информация`

        var stages = [
        ]

        function check(variant, stage) {
            return variant === stage.correct;
        }

        const STAGE_TEMPLATE = `
        <div id="sc-{stage}" class="stage-card">
            <h3>{stage-text}</h3>
            <div class="stage-variants">
                {variants}
            </div>
        </div>
    `
        const BUTTON_TEMPLATE = `
        <button id="btn-{variant-stage}" type="button" class="btn {variant-classes}" data-stage="{variant-stage}" data-vtext="{variant-text}" onclick="clicka(this)">{variant-text}</button>
    `
        function reset() {
            stages.forEach((stage, sIdx) => {
                localStorage.removeItem(sIdx);
            });
            render();
        }

        function clicka(btn) {
            if (localStorage.getItem(btn.dataset['stage'])) return;

            localStorage.setItem(btn.dataset['stage'], btn.dataset['vtext']);
            render();
        }
        function update() {

            stages.forEach((stage, sIdx) => {
                let loc = localStorage.getItem(sIdx);
                const sc = document.getElementById('sc-' + sIdx)
                if (loc) {
                    if (loc == stage.correct) {
                        sc.classList.toggle('stage-correct', true);
                        sc.classList.toggle('stage-wrong', false);
                    } else {
                        sc.classList.toggle('stage-correct', false);
                        sc.classList.toggle('stage-wrong', true);
                    }
                } else {
                    sc.classList.toggle('stage-correct', false);
                    sc.classList.toggle('stage-wrong', false);
                }
            });
        }

        function render() {

            let html = ""
            for (let index = 0; index < stages.length; index++) {
                const stage = stages[index];

                if (index > 0 && !localStorage.getItem(index - 1)) break;

                let vhtml = ""
                stage.variants.forEach(variant => {
                    let classes = ""
                    if (localStorage.getItem(index) == variant) classes += "btn-secondary "
                    else classes += "btn-light "
                    if (localStorage.getItem(index))
                        if (check(variant, stage)) classes += "variant-correct ";
                        else classes += "variant-wrong ";

                    console.log(localStorage.getItem(index), variant, localStorage.getItem(index) == variant, classes)
                    vhtml += BUTTON_TEMPLATE.replace(/{variant-classes}/gm, classes).replace(/{variant-stage}/gm, index).replace(/{variant-text}/gm, variant)
                });

                html += STAGE_TEMPLATE.replace(/{stage}/gm, index).replace(/{stage-text}/gm, index + 1).replace(/{variants}/gm, vhtml);
            };
            
            document.getElementById("Stages").innerHTML = html;

            update();

        }

        let lines = lNoNoise.split('\n');
        lines.forEach(ln => {
            ln = ln.split('\t')[1].split(' - ');
            let rnd = getRandomZeroOne();
            let nrnd = Math.abs(rnd-1);
            stages.push({
                variants: [ln[rnd], ln[nrnd]],
                correct: ln[0]
            })
        });
        render();


    </script>
</body>

</html>